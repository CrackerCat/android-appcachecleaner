os: linux
language: android
jdk: openjdk11

android:
  components:
    - tools
    - platform-tools
    - tools
    - extra-android-m2repository
env:
  global:
    - TARGET_VERSION=32
    - ANDROID_BUILD_TOOLS_VERSION=32.0.0
    - ANDROID_HOME=~/android-sdk

before_install:
  - touch $HOME/.android/repositories.cfg
  - wget "https://dl.google.com/android/repository/commandlinetools-linux-8092744_latest.zip" -O commandlinetools.zip
  - unzip commandlinetools.zip -d $ANDROID_HOME/
  - rm -f commandlinetools.zip
  - yes | $ANDROID_HOME/cmdline-tools/bin/sdkmanager "platforms;android-${TARGET_VERSION}" --sdk_root=$ANDROID_HOME
  - yes | $ANDROID_HOME/cmdline-tools/bin/sdkmanager "build-tools;${ANDROID_BUILD_TOOLS_VERSION}" --sdk_root=$ANDROID_HOME

before_script:
  - chmod +x gradlew

script:
  - "./gradlew clean build -PdisablePreDex --stacktrace"

after_success:
  - sh set_tags.sh

deploy:
  provider: releases
  skip_cleanup: true
  api_key:
    secure: OJDVviVzT4Mk43j7Y6hk6oLeuoM2AfEPM/HTkb8Z1rHNtDhO4P/czeyRxExcp+7fNBSM9aCVj8XIEUX5lKYpW9PZgz1gO6GeZUkyI6HVismtqayFj+EUlw/awhL75P7dlJBoQF+8XG9UYlccZAIdBSsCz3gEqP+hfwYCjUsiR6QiopKiDnK7qBxYZBp1AjgZJxsB3kCF/xYIm1QuIZGrgu50CEQI0o9Pm6YW7HpRQCpuBdKzTU9ui4389Kgru8Vt//QZg9Dcrawe4W2PiXqKOJ3oKQ4Em5L1p5H8l1mVyXXBDD4OlBP1xT3goGse4Ykg+iAM8azuzPuzhptET5snOBfG5slLolNFs/ce3X7WILwjKsgIGuyuX0d0o/vvVLvp3DnWJTJCPq0CIyVT1oMTTTX/BRzK0/d/uIXzR4zfmYqyRai3aA9NuzIdapIoMGEc/+PDRDGW5gyqZWySpKSFmAeCEHl7JvISPqsjeu7O60zgKmcYiug7jCQSrGdHC7l5CwxIu3mRxlElM2SgAMeQ+TbEVoip84rQw2XO2ywlMublWKC91P21wK+AAeZ/gCUZkwFg9qdOHdJoXlaYWUHkYaLIMNoszeBaNrn5LXPItsjNZJzVYwr+IFstBeUrKTv6/ghe58WYnVMhRMVIfnavCb5wXO46uu/TqK1c96d8dL4=
  file: app/build/outputs/apk/release/app-release.apk
  on:
    branch: main
    repo: bmx666/android-appcachecleaner

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/
    - $HOME/.android/build-cache
